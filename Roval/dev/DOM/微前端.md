Created Date：2024-03-03 20:30:26  
Last Modified：2024-03-03 20:30:26

# Tags

# Content

## 渲染

利用 `Web-Component API` 创建自定义元素，同时利用其生命周期函数，在里面执行一些操作：加载静态资源 `html`、`css`、`js`

```js
// 自定义元素
class MicroApp extends HTMLElement {
  // 声明需要监听的属性名，只有这些属性变化时才会触发attributeChangedCallback
  static get observedAttributes () {
    return ['name', 'url']
  }

  constructor() {
    super();
  }

  connectedCallback() {
    // 元素被插入到DOM时执行，此时去加载子应用的静态资源并渲染
    console.log('micro-app is connected')
  }

  disconnectedCallback () {
    // 元素从DOM中删除时执行，此时进行一些卸载操作
    console.log('micro-app has disconnected')
  }

  attributeChangedCallback (attr, oldVal, newVal) {
    // 元素属性发生变化时执行，可以获取name、url等属性的值
    console.log(`attribute ${attrName}: ${newVal}`)
  }
}

window.customElements.define('micro-app', MicroApp)
```

## 沙箱篇 - SandBox

主要目的是避免子应用的属性、事件与全局环境对象冲突、覆盖、污染。属性上，利用 `Proxy` 对其 `microAppWindow` 进行拦截 `get、set` 操作；事件上，重新定义 `microAppWindow` 上的 `addEventListener` 和 `removeEventListener`

最后调用 `bindScope` 利用 `with` 函数将子应用 `js code` 执行环境修改为 `window`

## 样式隔离篇

`style` 插入文档时会创建 `CSSStyleSheet` 样式表，通过 `.sheet.cssRules` 拿到 `CSSRuleList`，对其进行遍历，每个选择器前加上额外添加 `micro-app[name='xxx']` 选择器做到子应用的样式隔离

# Reference

[从零开始写一个微前端框架-渲染篇 · Issue #17 · micro-zoe/micro-app · GitHub](https://github.com/micro-zoe/micro-app/issues/17)  
[从零开始写一个微前端框架-沙箱篇 · Issue #19 · micro-zoe/micro-app · GitHub](https://github.com/micro-zoe/micro-app/issues/19)  
[从零开始写一个微前端框架-样式隔离篇 · Issue #20 · micro-zoe/micro-app · GitHub](https://github.com/micro-zoe/micro-app/issues/20)  
[从零开始写一个微前端框架-数据通信篇 · Issue #21 · micro-zoe/micro-app · GitHub](https://github.com/micro-zoe/micro-app/issues/21)
