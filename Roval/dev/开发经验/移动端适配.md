Created Date：2024-02-22 09:37:39  
Last Modified：2024-02-22 09:37:39

# Tags

# Content

## CSS 单位

### px

适用于 PC 端

### %

不同属性相对的可能是不同参考物，不推荐在适配时使用该单位

### rem

适用于 H5 端

### vw/vh

## 移动端适配

### rem + 动态设置 html font-size

```ad-abstract
（**手写px单位js自动转化rem单位**）
假设屏幕宽度 `375px` , `clientWidth = 375`  
`root-font-size` = `1/10` 份的 `clientWidth` = `1/10 * 375` = `1rem` = `37.5`  
`width: 37.5px;` = `37.5 / root-font-size` -> `37.5 / 37.5` -> `width: 1rem` = `1 * 37.5` -> `width: 37.5px;`，单位转化前后宽都占 `1/10`

（**手写rem单位，postcss设置root font-size**）
设置`rootValue: 100`，写CSS时方便计算
`width: 200px;` = `200/100` -> `width: 2rem;` = `2 * rootValue px` -> `width: 200px;`

转换`rem`是为了手写`rem`，用`rem`来实现页面在不同设备之间的适配
```

方法：

- 针对不同尺寸屏幕设置 `html font-size`
- 将原单位转为 `rem`

#### px 与 rem 的单位换算

手动换算：

- `html font-size` = 视口宽度/分成的份数 (一般为 10 份，方便计算)
- `rem` 值 = 元素的 `px` 值 / `html font-size` 值  
例如：屏幕尺寸为 `375px`，则应设置 `html font-size` 为 `37.5px`。`100px` 宽的盒子，其单位转为 `rem` 后为 `100/37.5=2.6667rem`

借助 `sass/less` 函数：

```css
.pxToRem(@px) {  
  result: 1rem * (@px / 37.5);  
}  
  
.box {  
  width: .pxToRem(100)[result];  
  height: .pxToRem(100)[result];  
  background-color: orange;  
}  
  
p {  
  font-size: .pxToRem(14)[result];  
}
```

借助构建工具集成 `postcss-pxtorem` 进行自动转化：

- `webpack` 配置文件中配置

```js
postcss: {
  plugins: isH5Mode === true ? [
    new Pxtorem({
      rootValue: 37.5, // 换算基数
      propList: ['*'],
      // propWhiteList: [], //默认值为空数组，禁用白名单并启用所有属性。
      // propBlackList: [], //黑名单
      exclude: /(node_module)/,
      selectorBlackList: ['html'], // 主要用于保留html内定义的rem基准的fontSize值
      mediaQuery: false, // （布尔值）允许在媒体查询中转换px。
      minPixelValue: 2 // 设置要替换的最小像素值(3px会被转rem)。 默认 0
    })
  ] : []
}
```

- `vite` 自动查找 `postcss.config.js` 中的配置并应用

```js
module.exports = {
  plugins: {
    autoprefixer: {},
    'postcss-plugin-px2rem': {
      rootValue: 37.5, // 设计稿宽度750px时的配置，可以根据设计稿大小调整此数值
      unitPrecision: 6,
      exclude: /(node_module)/i,
      minPixelValue: 2 // 小于2px的样式不会被转成rem，因为在部分设备上可能会出现小于1px而渲染失败
    }
  }
}
```

##### 媒体查询设置 font-size

```css
/* 以750为基准设置font-size为100px */
html{
  font-size: 38px;
}
@media only screen and (min-width: 320px) {
  html {
    font-size: 42.666px !important;
  }
}
@media only screen and (min-width: 360px) {
  html {
    font-size: 48px !important;
  }
}
@media only screen and (min-width: 375px) {
  html {
    font-size: 50px !important;
  }
}
@media only screen and (min-width: 414px) {
  html {
    font-size: 55.2px !important;
  }
}
@media only screen and (min-width: 480px) {
  html {
    font-size: 64px !important;
  }
}
@media only screen and (min-width: 560px) {
  html {
    font-size: 74.666px !important;
  }
}
@media only screen and (min-width: 640px) {
  html {
    font-size: 85.333px !important;
  }
}
@media only screen and (min-width: 720px) {
  html {
    font-size: 96px !important;
  }
}
@media only screen and (min-width: 750px) {
  html {
    font-size: 100px !important;
  }
}
@media only screen and (min-width: 800px) {
  html {
    font-size: 106.666px !important;
  }
}
@media only screen and (min-width: 960px) {
  html {
    font-size: 128px !important;
  }
}
```

##### js 检测视口宽度动态设置

```html
<script>
    (function flexible(window, document) {
    const docEl = document.documentElement
    const dpr = window.devicePixelRatio || 1

    // adjust body font size
    function setBodyFontSize() {
        if (document.body) {
        document.body.style.fontSize = (12 * dpr) + 'px'
        } else {
        document.addEventListener('DOMContentLoaded', setBodyFontSize)
        }
    }
    setBodyFontSize()

    // set 1rem = viewWidth / 10
    function setRemUnit() {
        const clientWidth = docEl.clientWidth > 540 ? 540 : docEl.clientWidth
        const rem = clientWidth / 10
        docEl.style.fontSize = rem + 'px'
    }

    setRemUnit()

    // reset rem unit on page resize
    window.addEventListener('resize', setRemUnit)
    window.addEventListener('pageShow', function(e) {
        if (e.persisted) {
        setRemUnit()
        }
    })
    window.addEventListener('load', setRemUnit)
    
    // detect 0.5px supports
    if (dpr >= 2) {
        var fakeBody = document.createElement('body')
        var testElement = document.createElement('div')
        testElement.style.border = '.5px solid transparent'
        fakeBody.appendChild(testElement)
        docEl.appendChild(fakeBody)
        if (testElement.offsetHeight === 1) {
        docEl.classList.add('hairlines')
        }
        docEl.removeChild(fakeBody)
    }
    })(window, document)
</script>
```

```html
<script>
  var docEl = document.documentElement
  var resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize'
  function adapt() {
    var d = window.document.createElement('p')
    d.style.width = '1rem'
    d.style.display = 'none'
    var head = window.document.getElementsByTagName('head')[0]
    head.appendChild(d)
    var defaultFontSize = parseFloat(getComputedStyle(d).width)
    return defaultFontSize
  }
  var defaultFontSize = adapt()
  var recalc = function() {
    var clientWidth = window.innerWidth || docEl.clientWidth || document.body.clientWidth
    // console.log(clientWidth)
    if (!clientWidth) return
    if (clientWidth >= 750) {
      docEl.style.fontSize = '625%' // browser default fontsize 16px
    } else {
      var rootFontSize = (clientWidth / 750) * 100
      // console.log(rootFontSize)
      docEl.style.fontSize = (rootFontSize / defaultFontSize) * 100 + '%'
    }
  }
  recalc()
  window.addEventListener(resizeEvt, recalc, false)
  document.addEventListener('DOMContentLoaded', recalc, false);
</script>
```

### vw/vh

`100vw` 相当于整个视口的宽度 `innerWidth`，`1vw` 相当于视口宽度的 **1%**  

`vw` 相比于 `rem` 的优势：

- 不依赖 `html font-size` 的尺寸，所以不用担心某些原因的 `html` 的 `font-size` 尺寸被篡改，导致页面尺寸混乱；
- `vw` 更加语义话，`1vw` 相当于 `1/100 viewport` 的大小；  

`rem` 事实上作为一种过渡的方案，它利用的也是 `vw` 的思想；

#### sass/less 函数

```css
@vwUnit: 3.75;  
.pxToVw(@px) {  
  result: (@px / @vw) * 1vw  
}  
.box {  
  width: .pxToVw(100)[result];  
  height: .pxToVw(100)[result];  
}
```

#### postcss 插件

```shell
pnpm add postcss-px-to-viewport-8-plugin -d
```

# Reference

[微信公众号 - 移动端适配](https://mp.weixin.qq.com/s/GEbaRxvakzGjmbwwxmyqfw)
